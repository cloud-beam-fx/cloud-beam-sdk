import{ethers as e}from"ethers";class t{constructor(e){this.rpcUrl=void 0,this.funcClientAddress=void 0,this.funcRegAddress=void 0,this.payMasterAddress=void 0,this.rpcUrl=e.rpcUrl,this.funcClientAddress=e.funcClientAddress||"",this.funcRegAddress=e.funcRegAddress||"",this.payMasterAddress=e.payMasterAddress||""}provider(){try{return Promise.resolve(new e.providers.JsonRpcProvider(this.rpcUrl))}catch(e){return Promise.reject(e)}}getFuncClientAddress(){try{return Promise.resolve(this.funcClientAddress)}catch(e){return Promise.reject(e)}}getFuncRegAddress(){try{return Promise.resolve(this.funcRegAddress)}catch(e){return Promise.reject(e)}}getPayMasterAddress(){try{return Promise.resolve(this.payMasterAddress)}catch(e){return Promise.reject(e)}}getFeeData(){try{const e=this;return Promise.resolve(function(t,n){try{var s=Promise.resolve(e.provider()).then(function(e){return Promise.resolve(e.getFeeData()).then(function(e){return{maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas,gasLimit:5e6}})})}catch(e){return n(e)}return s&&s.then?s.then(void 0,n):s}(0,function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}}const n=[{inputs:[{internalType:"address payable",name:"funcRegAddress_",type:"address"},{internalType:"address payable",name:"paymasterAddress_",type:"address"},{internalType:"address",name:"functionsConsumerAddress_",type:"address"},{internalType:"address payable",name:"adminAddress_",type:"address"},{internalType:"uint256",name:"requestFeeRate_",type:"uint256"},{internalType:"uint64",name:"subscriptionId_",type:"uint64"},{internalType:"uint32",name:"gasLimit_",type:"uint32"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"functionId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"requestId",type:"bytes32"}],name:"FuncRequest",type:"event"},{inputs:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"bytes",name:"returnData",type:"bytes"},{internalType:"bool",name:"status",type:"bool"},{internalType:"bytes",name:"err",type:"bytes"}],name:"fuffilRequest",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"functionId",type:"uint256"}],name:"getLatestRequest",outputs:[{components:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"string[]",name:"args",type:"string[]"},{internalType:"bytes",name:"returnData",type:"bytes"},{internalType:"bytes",name:"err",type:"bytes"},{internalType:"bool",name:"status",type:"bool"},{internalType:"uint256",name:"time",type:"uint256"}],internalType:"struct FuncClient.Request",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"functionId",type:"uint256"}],name:"getRequests",outputs:[{components:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"string[]",name:"args",type:"string[]"},{internalType:"bytes",name:"returnData",type:"bytes"},{internalType:"bytes",name:"err",type:"bytes"},{internalType:"bool",name:"status",type:"bool"},{internalType:"uint256",name:"time",type:"uint256"}],internalType:"struct FuncClient.Request[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"bytes32",name:"requestId",type:"bytes32"}],name:"getReturnData",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"string",name:"source",type:"string"},{internalType:"string[]",name:"args",type:"string[]"},{internalType:"bytes",name:"secrets",type:"bytes"}],name:"makeRequest",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"requestIdToFunctionId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],name:"requestList",outputs:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"bytes",name:"returnData",type:"bytes"},{internalType:"bytes",name:"err",type:"bytes"},{internalType:"bool",name:"status",type:"bool"},{internalType:"uint256",name:"time",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"requestMap",outputs:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"bytes",name:"returnData",type:"bytes"},{internalType:"bytes",name:"err",type:"bytes"},{internalType:"bool",name:"status",type:"bool"},{internalType:"uint256",name:"time",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"requestFeeRate_",type:"uint256"}],name:"updateFeeRate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"gasLimit_",type:"uint32"}],name:"updateGasLimit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"subscriptionId_",type:"uint64"}],name:"updateSubscriptionId",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"withdrawEth",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],s=[{inputs:[{internalType:"address",name:"_paymasterAddress",type:"address"},{internalType:"address",name:"admin",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"admin",type:"address"},{indexed:!0,internalType:"uint256",name:"id",type:"uint256"}],name:"FunctionRegCancel",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"id",type:"uint256"},{indexed:!0,internalType:"uint256",name:"status",type:"uint256"}],name:"FunctionStateChange",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"admin",type:"address"},{indexed:!0,internalType:"uint256",name:"id",type:"uint256"}],name:"NewFunctionRegistered",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"adminFunctions",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"cancelRegFunctions",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"functionIds",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"functionMap",outputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"address",name:"caller",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"enum FuncReg.Status",name:"status",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"}],name:"getAdminFunctions",outputs:[{components:[{internalType:"address",name:"admin",type:"address"},{internalType:"address",name:"caller",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"enum FuncReg.Status",name:"status",type:"uint8"}],internalType:"struct FuncReg.Function[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"getRegisteredFunction",outputs:[{components:[{internalType:"address",name:"admin",type:"address"},{internalType:"address",name:"caller",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"enum FuncReg.Status",name:"status",type:"uint8"}],internalType:"struct FuncReg.Function",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[],name:"getRegisteredFunctions",outputs:[{components:[{internalType:"address",name:"admin",type:"address"},{internalType:"address",name:"caller",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"functionId",type:"uint256"},{internalType:"enum FuncReg.Status",name:"status",type:"uint8"}],internalType:"struct FuncReg.Function[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"address",name:"caller",type:"address"},{internalType:"string",name:"topupToken",type:"string"}],name:"registerFunction",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"toogleFunctionState",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"withdrawEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenAddress",type:"address"}],name:"withdrawToken",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],r=[{inputs:[{internalType:"address",name:"linkEthAggrAddress_",type:"address"},{internalType:"address",name:"linkUsdAggrAddress_",type:"address"},{internalType:"address",name:"admin",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bool",name:"success",type:"bool"},{indexed:!0,internalType:"string",name:"token",type:"string"}],name:"AdminWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"admin",type:"address"},{indexed:!0,internalType:"uint256",name:"id",type:"uint256"}],name:"NewFunctionAdded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"admin",type:"address"},{indexed:!0,internalType:"bool",name:"success",type:"bool"}],name:"TopUp",type:"event"},{inputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"functionId",type:"uint256"}],name:"addFunction",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"string",name:"ticker",type:"string"}],name:"addTopUpToken",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"adminAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"ticker",type:"string"}],name:"adminWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"string",name:"",type:"string"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"funcClientAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"functionRegAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"string",name:"topupToken",type:"string"}],name:"getAdminBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"getConversion",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"functionId",type:"uint256"}],name:"getFunction",outputs:[{components:[{internalType:"address",name:"admin",type:"address"},{internalType:"uint256",name:"functionId",type:"uint256"},{components:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"string",name:"ticker",type:"string"}],internalType:"struct PayMaster.Topup",name:"topupToken",type:"tuple"}],internalType:"struct PayMaster.Function",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"ticker",type:"string"}],name:"getTopUpToken",outputs:[{components:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"string",name:"ticker",type:"string"}],internalType:"struct PayMaster.Topup",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[],name:"linkEthAggrAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"linkUsdAggrAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"pay",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"regFunctionsMap",outputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"uint256",name:"functionId",type:"uint256"},{components:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"string",name:"ticker",type:"string"}],internalType:"struct PayMaster.Topup",name:"topupToken",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"functionRegAddr",type:"address"},{internalType:"address",name:"funcClient",type:"address"}],name:"setup",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"},{internalType:"string",name:"topupToken",type:"string"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"topUp",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"",type:"string"}],name:"topups",outputs:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"string",name:"ticker",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdrawEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenAddress",type:"address"}],name:"withdrawToken",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],a=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}];function i(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}class u extends t{registerFunction(t,n,r){try{const a=this;return Promise.resolve(i(function(){return Promise.resolve(a.getFuncRegAddress()).then(function(i){const u=new e.Contract(i,s,t);return Promise.resolve(a.getFeeData()).then(function(e){return Promise.resolve(u.registerFunction(t.getAddress(),n,r,e)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Function registration failed");const t=e.events?.filter(e=>"NewFunctionRegistered"==e.event)[0];return t.args.id.toNumber()})})})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}getRegFunction(t){try{const n=this;return Promise.resolve(i(function(){return Promise.resolve(n.provider()).then(function(r){return Promise.resolve(n.getFuncRegAddress()).then(function(n){const a=new e.Contract(n,s,r);return Promise.resolve(a.getRegisteredFunction(t))})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}getAdminFunctions(t){try{const n=this;return Promise.resolve(i(function(){return Promise.resolve(n.provider()).then(function(r){return Promise.resolve(n.getFuncRegAddress()).then(function(n){const a=new e.Contract(n,s,r);return Promise.resolve(a.getAdminFunctions(t))})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}toogleFunctionState(t,n){try{const r=this;return Promise.resolve(i(function(){let a;return Promise.resolve(r.getFuncRegAddress()).then(function(i){const u=new e.Contract(i,s,t);return Promise.resolve(r.getFeeData()).then(function(e){return Promise.resolve(u.toogleFunctionState(n,e)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Function status toogle failed");const t=e.events?.filter(e=>"FunctionStateChange"==e.event)[0];return console.log(t.args.status),0==t.args.status?a="active":1==t.args.status&&(a="paused"),a})})})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}topup(t,n,s){try{const a=this;return Promise.resolve(i(function(){return Promise.resolve(a.getFeeData()).then(function(i){return Promise.resolve(a.getPayMasterAddress()).then(function(u){let o;function p(a){if(o)return a;const p=new e.Contract(u,r,t);return Promise.resolve(p.topup(t.getAddress(),s,n,i)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Topup failed");const t=e.events?.filter(e=>"TopUp"==e.event)[0];return console.log(t.args.success),t.args.success})})}const y=function(){if("ETH"===s){const s=e.utils,r=s.formatEther;return Promise.resolve(t.getBalance()).then(function(u){let p=r.call(s,u);if(parseInt(p)<n)throw new Error("Insufficient ETH balance");return Promise.resolve(a.getPayMasterAddress()).then(function(s){const r={to:s,value:e.utils.parseEther(n.toString()),from:t.getAddress(),maxFeePerGas:i.maxFeePerGas,maxPriorityFeePerGas:i.maxPriorityFeePerGas,gasLimit:i.gasLimit};return Promise.resolve(t.sendTransaction(r)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Topup failed");return o=!0})})})})}}();return y&&y.then?y.then(p):p(y)})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}adminWithdraw(t,n){try{const s=this;return Promise.resolve(i(function(){return Promise.resolve(s.getFeeData()).then(function(a){return Promise.resolve(s.getPayMasterAddress()).then(function(s){const i=new e.Contract(s,r,t);return Promise.resolve(i.adminWithdraw(n,a)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Withdraw failed");const t=e.events?.filter(e=>"AdminWithdrawn"==e.event)[0];return console.log(t.args.success),t.args.success})})})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}getAdminBalance(t,n){try{const s=this;return Promise.resolve(i(function(){return Promise.resolve(s.provider()).then(function(a){return Promise.resolve(s.getPayMasterAddress()).then(function(s){const i=new e.Contract(s,r,a);if("ETH"===n){const s=e.utils,r=s.formatEther;return Promise.resolve(i.getAdminBalance(t,n)).then(function(e){return parseInt(r.call(s,e))})}{const s=e.utils,r=s.formatUnits;return Promise.resolve(i.getAdminBalance(t,n)).then(function(e){return parseInt(r.call(s,e,10))})}})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}makeRequest(t,s,r,a,u){try{const o=this;return Promise.resolve(i(function(){return Promise.resolve(o.getFeeData()).then(function(i){return Promise.resolve(o.getFuncClientAddress()).then(function(o){const p=new e.Contract(o,n,t);return Promise.resolve(p.makeRequest(s,a,r,u,i)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Request failed");const t=e.events?.filter(e=>"FuncRequest"==e.event)[0];return console.log(t.args.success),{functionId:t.args.functionId,requestId:t.args.requestId}})})})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}stopFunction(t,s){try{const r=this;return Promise.resolve(i(function(){return Promise.resolve(r.getFeeData()).then(function(a){return Promise.resolve(r.getFuncClientAddress()).then(function(r){const i=new e.Contract(r,n,t);return Promise.resolve(i.stopFunction(s,a)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Function stop failed");const t=e.events?.filter(e=>"FunctionStopped"==e.event)[0];return console.log(t.args.success),t.args.success})})})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}getLatestRequest(t){try{const s=this;return Promise.resolve(i(function(){return Promise.resolve(s.provider()).then(function(r){return Promise.resolve(s.getFuncClientAddress()).then(function(s){const a=new e.Contract(s,n,r);return Promise.resolve(a.getLatestRequest(t))})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}getAllRequest(t){try{const s=this;return Promise.resolve(i(function(){return Promise.resolve(s.provider()).then(function(r){return Promise.resolve(s.getFuncClientAddress()).then(function(s){const a=new e.Contract(s,n,r);return Promise.resolve(a.getRequests(t))})})},function(e){throw console.log(e.message),new Error(e.message)}))}catch(e){return Promise.reject(e)}}approveSpend(t,n,s){const u=this;return new Promise(function(o,p){try{return Promise.resolve(i(function(){return Promise.resolve(u.getFeeData()).then(function(i){return Promise.resolve(u.getPayMasterAddress()).then(function(u){const o=new e.Contract(u,r,t);return Promise.resolve(o.getTopUpToken(s)).then(function(s){const r=new e.Contract(s.tokenAddress,a,t),o=e.utils,p=o.formatUnits;return Promise.resolve(r.balanceOf(t.getAddress())).then(function(e){const t=p.call(o,e,10);if(parseInt(t)<n)throw new Error("Insufficient balance");return Promise.resolve(r.approve(u,n,i)).then(function(e){return Promise.resolve(e.wait()).then(function(e){if(0==e.status)throw new Error("Approve spend failed");return!0})})})})})})},function(e){console.log(e.message),p(e.message)}))}catch(e){return Promise.reject(e)}})}}class o extends u{}var p;p=o,[u].forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(t=>{Object.defineProperty(p.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))})});export{o as default};
//# sourceMappingURL=index.m.js.map
